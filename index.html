<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>DApp untuk Korban Berinteraksi dengan Smart Contract</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/5.7.2/ethers.umd.min.js"></script>
</head>
<body>

<h1>Interact with Smart Contract as Victim</h1>

<!-- Connect Wallet Button -->
<button id="connectWallet">Connect Wallet</button>

<!-- Form to Approve Token -->
<h2>Approve Token</h2>
<div id="approveInfo">
  <p>Your connected wallet: <span id="walletAddress"></span></p>
  <label for="approveAmount">Amount:</label>
  <input type="number" id="approveAmount" name="approveAmount" min="1" required><br><br>
  <button id="approveButton" type="submit">Approve Token</button>
</div>

<script>
  // Initialize ethers.js
  let provider, contract, signer;

  const contractAddress = '0x8816e4c39472B5Ce851fB8cB271de419bF638f43';
  const contractABI = [
    {
      "inputs": [
        {
          "internalType": "address",
          "name": "spender",
          "type": "address"
        },
        {
          "internalType": "uint256",
          "name": "amount",
          "type": "uint256"
        }
      ],
      "name": "approve",
      "outputs": [
        {
          "internalType": "bool",
          "name": "",
          "type": "bool"
        }
      ],
      "stateMutability": "nonpayable",
      "type": "function"
    }
  ];

  // Function to connect wallet
  async function connectWallet() {
    if (window.ethereum) {
      try {
        await ethereum.request({ method: 'eth_requestAccounts' });
        provider = new ethers.providers.Web3Provider(window.ethereum);
        signer = provider.getSigner();
        contract = new ethers.Contract(contractAddress, contractABI, signer);

        // Menampilkan alamat wallet yang terhubung
        document.getElementById('walletAddress').innerText = await signer.getAddress();
        document.getElementById('approveInfo').style.display = 'block';
      } catch (err) {
        console.error(err);
      }
    } else {
      console.log('MetaMask not installed');
    }
  }

  // Approve Token
  document.getElementById('approveButton').addEventListener('click', async (e) => {
    e.preventDefault();
    const amount = document.getElementById('approveAmount').value;

    try {
      const tx = await contract.approve(await signer.getAddress(), ethers.utils.parseUnits(amount, 18));
      console.log('Transaction successful:', tx);
    } catch (err) {
      console.error(err);
    }
  });

  // Connect Wallet Button
  document.getElementById('connectWallet').addEventListener('click', connectWallet);
</script>

</body>
</html>
